<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>OCAT Style Guide for R Code</title>
  <meta name="description" content="OCAT Style Guide for R Code" />
  <meta name="generator" content="bookdown 0.22 and GitBook 2.6.7" />

  <meta property="og:title" content="OCAT Style Guide for R Code" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="OCAT Style Guide for R Code" />
  
  
  

<meta name="author" content="OCAT Team" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  


<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>


<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style_guidance.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path=""><a href="#introduction"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path=""><a href="#quick-reference-guide"><i class="fa fa-check"></i><b>1.1</b> Quick Reference Guide</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path=""><a href="#names"><i class="fa fa-check"></i><b>2</b> Names</a><ul>
<li class="chapter" data-level="2.1" data-path=""><a href="#names-file"><i class="fa fa-check"></i><b>2.1</b> File names</a></li>
<li class="chapter" data-level="2.2" data-path=""><a href="#names-object"><i class="fa fa-check"></i><b>2.2</b> Object names</a></li>
<li class="chapter" data-level="2.3" data-path=""><a href="#names-column"><i class="fa fa-check"></i><b>2.3</b> Columns</a></li>
<li class="chapter" data-level="2.4" data-path=""><a href="#names-r-code-chunks"><i class="fa fa-check"></i><b>2.4</b> R Code Chunks</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path=""><a href="#organisation"><i class="fa fa-check"></i><b>3</b> Organisation</a><ul>
<li class="chapter" data-level="3.1" data-path=""><a href="#organisation-project"><i class="fa fa-check"></i><b>3.1</b> Project</a></li>
<li class="chapter" data-level="3.2" data-path=""><a href="#organisation-scripts"><i class="fa fa-check"></i><b>3.2</b> Scripts</a></li>
<li class="chapter" data-level="3.3" data-path=""><a href="#organisation-modularisation"><i class="fa fa-check"></i><b>3.3</b> Modularisation</a></li>
<li class="chapter" data-level="3.4" data-path=""><a href="#organisation-version-control"><i class="fa fa-check"></i><b>3.4</b> Version Control</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path=""><a href="#styling"><i class="fa fa-check"></i><b>4</b> Styling</a><ul>
<li class="chapter" data-level="4.1" data-path=""><a href="#styling-commenting"><i class="fa fa-check"></i><b>4.1</b> Commenting</a><ul>
<li class="chapter" data-level="4.1.1" data-path=""><a href="#commenting"><i class="fa fa-check"></i><b>4.1.1</b> Commenting</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path=""><a href="#styling-internal-structure"><i class="fa fa-check"></i><b>4.2</b> Internal Structure</a></li>
<li class="chapter" data-level="4.3" data-path=""><a href="#styling-assignment"><i class="fa fa-check"></i><b>4.3</b> Assignment</a></li>
<li class="chapter" data-level="4.4" data-path=""><a href="#styling-whitespace"><i class="fa fa-check"></i><b>4.4</b> Whitespace</a><ul>
<li class="chapter" data-level="4.4.1" data-path=""><a href="#styling-operators"><i class="fa fa-check"></i><b>4.4.1</b> Operators</a></li>
<li class="chapter" data-level="4.4.2" data-path=""><a href="#styling-functions"><i class="fa fa-check"></i><b>4.4.2</b> Parenthesis &amp; Functions</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path=""><a href="#styling-long-lines"><i class="fa fa-check"></i><b>4.5</b> Avoid Long lines</a><ul>
<li class="chapter" data-level="4.5.1" data-path=""><a href="#styling-pipe"><i class="fa fa-check"></i><b>4.5.1</b> Pipe</a></li>
<li class="chapter" data-level="4.5.2" data-path=""><a href="#styling-charts"><i class="fa fa-check"></i><b>4.5.2</b> Charts</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path=""><a href="#styling-arguments"><i class="fa fa-check"></i><b>4.6</b> Arguments</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path=""><a href="#packages"><i class="fa fa-check"></i><b>5</b> Packages</a><ul>
<li class="chapter" data-level="5.1" data-path=""><a href="#packages-getting-started"><i class="fa fa-check"></i><b>5.1</b> Getting started</a></li>
<li class="chapter" data-level="5.2" data-path=""><a href="#packages-load"><i class="fa fa-check"></i><b>5.2</b> Load packages</a></li>
<li class="chapter" data-level="5.3" data-path=""><a href="#packages-import-data"><i class="fa fa-check"></i><b>5.3</b> Import data</a></li>
<li class="chapter" data-level="5.4" data-path=""><a href="#packages-style-selection"><i class="fa fa-check"></i><b>5.4</b> Style selection examples</a></li>
<li class="chapter" data-level="5.5" data-path=""><a href="#packages-lintr"><i class="fa fa-check"></i><b>5.5</b> Lintr Example</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">OCAT Style Guide for R Code</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="header">
<h1 class="title">OCAT Style Guide for R Code</h1>
<p class="author"><em>OCAT Team</em></p>
</div>
<!-- You need version of R > 3.6.3 and bookdown installed to generate a book -->
<!--# OCAT Style Guide for R Code-->
<!-- Note: File must start with h2 (##) as this Introduction sits below the main OCAT title in the skeleton rmd. -->
<div id="introduction" class="section level1">
<h1><span class="header-section-number">1</span> Introduction</h1>
<p>Welcome to the OCAT style guide!</p>
<p>We’ve created this guide with the aim of improving readability and providing some consistency across R scripts and projects in the team.</p>
<p>In the words of the great Hadley Wickham, <em>“good styling is like correct punctuation: you can manage without it, butitsuremakesthingseasiertoread”</em>.</p>
<p>Just like any other language, there are often many ways of saying the same thing or getting to the same point in R. Whilst diversity is great, this guide sets out some key principles to provide some standardised format across the team.</p>
<p>We still want the “ay up” in the North and “hello” in the South, just with a similar format applied!</p>
<p>This guide covers:</p>
<li>
<a href="#names">Names</a>: files, objects, columns, chunks
<li>
<a href="#organisation">Organisation</a>: projects, scripts, modularisation
<li>
<a href="#styling">Styling</a>: adding comments, whitespace and length of code
<li>
<a href="#packages">Packages</a>: useful packages to help us format our code
</li>
<p>This guide takes inspiration from the <a href="https://style.tidyverse.org/index.html">tidyverse style guide</a>.</p>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-1"></span>
<img src="goodcodebadcode_adapted.jpg" alt="Code Quality Measurement, adapted from the book 'Clean Code' by Robert Martin" width="50%" />
<p class="caption">
Figure 1.1: Code Quality Measurement, adapted from the book ‘Clean Code’ by Robert Martin
</p>
</div>
<div id="quick-reference-guide" class="section level2">
<h2><span class="header-section-number">1.1</span> Quick Reference Guide</h2>
<p>The below is a quick reference guide with key points. Please refer to specific sections within this guide for more detail.</p>
<p><img src="20210525_OCAT_Code_Style_Guide_QuickRef_v0a.jpg" width="100%" /></p>
<hr>
<!-- Note: File must start with h1 (#) as this forms a new chapter. -->
</div>
</div>
<div id="names" class="section level1">
<h1><span class="header-section-number">2</span> Names</h1>
<p>Meaningful and consistent names for files, objects, columns and chunks of code make it easier for the user to understand and navigate around the script. This section includes guidance and examples on naming.</p>
<div id="names-file" class="section level2">
<h2><span class="header-section-number">2.1</span> File names</h2>
<p>Key points:</p>
<p><strong>Do</strong></p>
<ul>
<li>
Meaningful file names
<li>
Use letters, numbers, - and _
<li>
Lowercase (easier to remember)
<li>
Files which include a single function should be called the same as the function
<li>
If a file contains multiple functions, try to give it a concise but meaningful name
<li>
If files should be run in a particular order then number them BUT be sure to keep this numbering up to date.
</li>
</ul>
<p><strong>Avoid</strong></p>
<ul>
<li>
Avoid using special characters
<li>
Spaces between words
</li>
</ul>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" title="1"><span class="co"># File names: Good</span></a>
<a class="sourceLine" id="cb1-2" title="2"></a>
<a class="sourceLine" id="cb1-3" title="3"><span class="st">&quot;data_manipulation.R&quot;</span></a>
<a class="sourceLine" id="cb1-4" title="4"><span class="st">&quot;chart_functions.R&quot;</span></a>
<a class="sourceLine" id="cb1-5" title="5"></a>
<a class="sourceLine" id="cb1-6" title="6"></a>
<a class="sourceLine" id="cb1-7" title="7"><span class="st">&quot;01_functions.R&quot;</span></a>
<a class="sourceLine" id="cb1-8" title="8"><span class="st">&quot;02_datacleaning.R&quot;</span></a>
<a class="sourceLine" id="cb1-9" title="9"><span class="st">&quot;03_charts.R&quot;</span></a>
<a class="sourceLine" id="cb1-10" title="10"></a>
<a class="sourceLine" id="cb1-11" title="11"></a>
<a class="sourceLine" id="cb1-12" title="12"><span class="co"># File names: Avoid (spaces between words, upper and lower case, symbols)</span></a>
<a class="sourceLine" id="cb1-13" title="13"><span class="st">&quot;Data Manipulation.R&quot;</span></a>
<a class="sourceLine" id="cb1-14" title="14"><span class="st">&quot;chart functions &amp; testing.R&quot;</span></a></code></pre></div>
</div>
<div id="names-object" class="section level2">
<h2><span class="header-section-number">2.2</span> Object names</h2>
<p>Similar to files names, object names should ideally only use:</p>
<ul>
<li>
lowercase <br>
<li>
numbers <br>
<li>
underscores (_) to separate words
</li>
</ul>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" title="1"><span class="co"># Object names: Good</span></a>
<a class="sourceLine" id="cb2-2" title="2">chart_highest_three</a>
<a class="sourceLine" id="cb2-3" title="3">chart_highest_<span class="dv">3</span></a>
<a class="sourceLine" id="cb2-4" title="4"></a>
<a class="sourceLine" id="cb2-5" title="5"><span class="co"># Object names: Avoid (mix of upper and lowercase, lack of underscore to separate words)</span></a>
<a class="sourceLine" id="cb2-6" title="6">highestThree</a>
<a class="sourceLine" id="cb2-7" title="7">charthighestthree</a></code></pre></div>
<p>Try to make the object names meaningful (i.e. relating to what they include) and following a similar structure, for example:</p>
<ul>
<li>
functions: fn_name
<li>
raw data: data_raw_name
<li>
data: data_name
<li>
charts: chart_name
<li>
database connections: db_name
</li>
</ul>
<p><strong>Functions</strong></p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" title="1">fn_crude_rate</a>
<a class="sourceLine" id="cb3-2" title="2">fn_clean_data</a></code></pre></div>
<p><strong>Raw data</strong></p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" title="1">data_raw_MYE</a>
<a class="sourceLine" id="cb4-2" title="2">data_raw_deaths</a></code></pre></div>
<p><strong>Data</strong></p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" title="1">data_deaths_by_year</a>
<a class="sourceLine" id="cb5-2" title="2">data_total_admissions</a></code></pre></div>
<p><strong>Charts</strong></p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" title="1">chart_health_board</a>
<a class="sourceLine" id="cb6-2" title="2">chart_total_pop</a></code></pre></div>
<p><strong>Database Connections</strong></p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" title="1">db_odbc &lt;-<span class="st"> </span><span class="kw">dbConnect</span>(odbc<span class="op">::</span><span class="kw">odbc</span>(), <span class="st">&quot;ODBC_R&quot;</span>)</a></code></pre></div>
</div>
<div id="names-column" class="section level2">
<h2><span class="header-section-number">2.3</span> Columns</h2>
<ul>
<li>
Use _ to separate word (avoid spaces)
<li>
Meaningful - clear what data it includes.
<li>
Avoid columns which are a duplication of others (e.g. total2, dateauthorised2)
</li>
</ul>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" title="1">data &lt;-<span class="st"> </span>data <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb8-2" title="2"><span class="st">          </span><span class="kw">mutate</span>(<span class="dt">local_authority =</span> <span class="st">&quot;Cardiff&quot;</span>,</a>
<a class="sourceLine" id="cb8-3" title="3">                 <span class="dt">health_board =</span> <span class="st">&quot;Cardiff &amp; Vale&quot;</span>,</a>
<a class="sourceLine" id="cb8-4" title="4">                 <span class="dt">total_population =</span> population)</a></code></pre></div>
</div>
<div id="names-r-code-chunks" class="section level2">
<h2><span class="header-section-number">2.4</span> R Code Chunks</h2>
<p>When creating rmd scripts, it can be useful to label your chunks of code.</p>
<p>This has two main benefits: <br>
1. Helps you to navigate around your R script (acts like a contents) <br>
2. Easily identify specific code chunks which might have caused the script to fall over.</p>
<p><em>Example code chunk names and use of scroll</em></p>
<p><img src="codechunknames_v0a.jpg" width="600" /></p>
<p>See also <a href="#styling-internal-structure">Internal Structure</a> section in this guide for alternative ways to denote sections.</p>
<hr>
<!-- Note: File must start with h1 (#) as this forms a new chapter. -->
</div>
</div>
<div id="organisation" class="section level1">
<h1><span class="header-section-number">3</span> Organisation</h1>
<p>It really pays off to create an organised file structure from the start; it is much harder to re-organise files when you are further along in developing the project.</p>
<p>This section provides guidance on how to structure a project and single script.</p>
<div id="organisation-project" class="section level2">
<h2><span class="header-section-number">3.1</span> Project</h2>
<p>Working in an R Project has various benefits:</p>
<ul>
<li>
The project folder becomes the working directory, so all file paths are relative to that folder. For example, to import a csv file, just the file name needs to be added to the read command.
</li>
<ul>
<li><code> my_raw_data &lt;- read.csv(“my_data_file.csv”, stringsAsFactors = FALSE) </code></li>
</ul>
<li>
Sharing the project files with another user then means that R will find files when run on their system.
</li>
<li>
Project files and sub-folders need to be contained within one main directory for publishing to shiny apps.
</li>
<li>
The project files can be navigated to easily in the ‘Files’ tab of the RStudio window.
</li>
</ul>
<p><strong>Create a Project</strong></p>
<p>To create a New Project in RStudio, select <code>File | New Project…</code> and you can either start from scratch in a new directory, or select an existing directory where you’ve already started to store your project files.</p>
<p><strong>Project Sub-Folders</strong></p>
<p>It’s good practice to keep data files in a separate sub-folder, so the relative file path to a sub-folder will be “./data/my_data_file.csv”</p>
<ul>
<ul>
<li><code> my_raw_data &lt;- read.csv(“./data/my_data_file.csv”, stringsAsFactors = FALSE) </code></li>
</ul>
</ul>
</div>
<div id="organisation-scripts" class="section level2">
<h2><span class="header-section-number">3.2</span> Scripts</h2>
<p>Whilst scripts are created for many different purposes, they often follow a similar structure:</p>
<ol style="list-style-type: decimal">
<li>Load packages <br></li>
<li>Set up any connections (e.g. SQL) <br></li>
<li>Read in functions <br></li>
<li>Set parameters</li>
<li>Read in data <br></li>
<li>Data manipulation <br></li>
<li>Analysis/outputs (charts, tables etc. for end use) <br></li>
</ol>
<p>Example script structure:</p>
<p><strong>1. Load packages</strong></p>
<p>All packages required for the script should be loaded at the start.
This enables the user to immediately identify which packages might need to be installed, avoids any hidden dependencies and keeps a good structure to the script.</p>
<p>We would recommend keeping all required packages in a seprate file which can be read into the script at the start.</p>
<p><code> source(“packages.R”) </code></p>
<p>However if you would rather have your packages in your script, keep them in a single chunk (see example below).</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" title="1"><span class="kw">library</span>(tidyverse)</a>
<a class="sourceLine" id="cb9-2" title="2"><span class="kw">library</span>(ggplot2)</a>
<a class="sourceLine" id="cb9-3" title="3"><span class="kw">library</span>(leaflet)</a>
<a class="sourceLine" id="cb9-4" title="4"><span class="kw">library</span>(lubridate)</a></code></pre></div>
<p><strong>2. Set up connections</strong></p>
<p>If connections to databases are required, set these up toward the start of the script. This allows the users to immediately identify any connections required.</p>
<p>Please refer to the OCAT teams ‘Knowledge base’ for guidance on how to set up an ODBC connection.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" title="1">db_odbc &lt;-<span class="st"> </span><span class="kw">dbConnect</span>(odbc<span class="op">::</span><span class="kw">odbc</span>(), <span class="st">&quot;ODBC_R&quot;</span>)</a></code></pre></div>
<p><strong>3. Read in functions</strong></p>
<p>It is useful to keep functions in one place, whether this is in a single file or in multiple files.
Ensure your <a href="#names-object">functions files</a> are clearly labelled.</p>
<p>You can use the <code> source() </code> command to read in separate functions files.
Alternatively if you have a number of functions to import, you might want to use the list and lapply commands.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" title="1"><span class="co"># Example: import separate files</span></a>
<a class="sourceLine" id="cb11-2" title="2"><span class="kw">source</span>(<span class="st">&quot;fn_cruderate&quot;</span>)</a>
<a class="sourceLine" id="cb11-3" title="3"><span class="kw">source</span>(<span class="st">&quot;fn_easr&quot;</span>)</a>
<a class="sourceLine" id="cb11-4" title="4"><span class="kw">source</span>(<span class="st">&quot;fn_charts&quot;</span>)</a>
<a class="sourceLine" id="cb11-5" title="5"></a>
<a class="sourceLine" id="cb11-6" title="6"><span class="co"># Example: import as part of a list</span></a>
<a class="sourceLine" id="cb11-7" title="7">my_list &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;fn_cruderate&quot;</span>, <span class="st">&quot;fn_easr&quot;</span>, <span class="st">&quot;fn_charts&quot;</span>)</a>
<a class="sourceLine" id="cb11-8" title="8"><span class="kw">lapply</span>(my_list, source)</a></code></pre></div>
<p><strong>4. Set parameters</strong></p>
<p>Sometimes scripts require manual changes to update the week numbers, dates, specific filters etc. used within the code.</p>
<p>It is good practice to place these in objects and in one place toward the start of the script, so that it is clear that the user needs to change these.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" title="1"><span class="co"># Example set parameters for week numbers</span></a>
<a class="sourceLine" id="cb12-2" title="2">min_weekno &lt;-<span class="st"> </span><span class="dv">3</span></a>
<a class="sourceLine" id="cb12-3" title="3">min_weekno &lt;-<span class="st"> </span><span class="dv">18</span></a>
<a class="sourceLine" id="cb12-4" title="4"></a>
<a class="sourceLine" id="cb12-5" title="5"><span class="co"># Example set parameters for date</span></a>
<a class="sourceLine" id="cb12-6" title="6">max_date &lt;-<span class="st"> &quot;2021-06-02&quot;</span></a></code></pre></div>
<p><strong>5. Read in data</strong></p>
<p>Import all data required for the analysis in one chunk.</p>
<ul>
This allows the user to:
<li>
quickly understand which data are being used
<li>
flag any data import issues in one place
</li>
</ul>
<p>When importing raw data, you might want to signify this in the <a href="#names-object">object name</a>.</p>
<p>Try to keep an ‘untouched’ version of the raw data in its own dataframe; any changes made to the raw data should be placed in a new dataframe.
Keeping a raw version of the data provides the option for the user to return to the original data if required. This might be useful for data checks and particularly beneficial when working with very large datasets which take a long time to import!</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" title="1">data_raw_MYE &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;ONS_MYE_Population_v0a.csv&quot;</span>)</a></code></pre></div>
<p><strong>6. Data Manipulation</strong></p>
<p>This is usually the largest section within a script and often include commands from base R and the tidyverse packages such as:
filter(), select(), mutate() subset() as.character(), as.numeric() etc.</p>
<p>Try to find a balance between <a href="#styling-commenting">commenting</a> this section so clear on the process whilst not being too descriptive.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" title="1"><span class="co"># Filter data for LA and add column for HB</span></a>
<a class="sourceLine" id="cb14-2" title="2"></a>
<a class="sourceLine" id="cb14-3" title="3">data_MYE &lt;-<span class="st"> </span>data_raw_MYE <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb14-4" title="4"><span class="st">  </span><span class="kw">filter</span>(local_authority <span class="op">==</span><span class="st"> &quot;Cardiff&quot;</span>)</a></code></pre></div>
<p><strong>7. Analysis outputs</strong></p>
<p>Often the final section of the script which will include outputting data in a format to be used elsewhere (e.g. datatable, chart etc.).</p>
<p>Avoid writing to a specific file path - if you have set up a project, outputs are usually written to project folder.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" title="1"><span class="co"># include chart example here</span></a></code></pre></div>
</div>
<div id="organisation-modularisation" class="section level2">
<h2><span class="header-section-number">3.3</span> Modularisation</h2>
<p>Modularising is simply splitting your script into chunks (modules), with each carrying out a separate command.
In bringing each of these modules (scripts) together, you produce an output.</p>
<p>Often the easiest way to approach modularisation is to start with an existing script and move chunks of code to separate scripts.
Individual scripts are then read in to the ‘main’ script using the <code> source(“script_name.R”) </code> or <code> child = “script_name.Rmd” </code> commands.</p>
<p><img src="modularisation_v0d.jpg" width="600" /></p>
<p>Modularising a script is a good way of:</p>
<li>
ensuring scripts are not too long
<li>
enabling different aspects of the project to progress simultaneously
<li>
can be easier to identify and locate errors
</li>
<p>The figure below illustrates modularisation of scripts. Note how each file is named based on the order it is imported into the main script, refer to the <a href="#names-file">File Names</a> section of this guide for more detail.</p>
<p><img src="modularisation_folders.jpg" width="350" /></p>
</div>
<div id="organisation-version-control" class="section level2">
<h2><span class="header-section-number">3.4</span> Version Control</h2>
<p><em>This section will be completed at a later stage</em></p>
<hr>
<!-- Note: File must start with h2 (##) as this forms a new tab. All other headings must be level 3 (###) or higher -->
</div>
</div>
<div id="styling" class="section level1">
<h1><span class="header-section-number">4</span> Styling</h1>
<p>
The aim is to find the balance between:
<li>
a well commented script with clear annotation and
<li>
a script which is readable and not too lengthy for others to pick up
</li>
</p>
<p>However, this is often easier said than done! This section provides a few pointers to help achieve this balance.</p>
<p>Key points:</p>
<li>
Often in dplyr or ggplot anything following a <code> %&gt;% </code> or <code> + </code> should be followed by a new line of code.
<li>
Exceptions to the rule above using short pipes.
<li>
Assigment of object should always be object on the left
<li>
Avoid using long lines of code - if they don’t fit into one line then use multiple lines
<li>
Good practice to include <code> () </code> even when no arguments are passed through the command
</li>
<p>
This section looks at ways to help readability of the script through:
<li>
comments and separators
<li>
white space
<li>
lines
<li>
commands
</li>
</p>
<div id="styling-commenting" class="section level2">
<h2><span class="header-section-number">4.1</span> Commenting</h2>
<div id="commenting" class="section level3">
<h3><span class="header-section-number">4.1.1</span> Commenting</h3>
<p>Comments are a great way of helping the user read through your script, follow your rationale and understand what the code is supposed to be doing. It is really important to comment your code (especially whilst the script is in development stage), as it will not only help others but also yourself when returning to the script after a weekend - I’m sure we’ve all had that moment on a Monday morning trying to work out what on earth we were trying to do with our code the previous Friday!</p>
<p>During the development stages of your code, it’s often useful to include comments on what you’ve tried, why you’re using a certain approach and hyperlinks to any websites you might have used. It might also be useful to keep a ‘status of code’ summary at the start of the development code to log what’s been done (i.e. progress, what you’ve got working) and what is yet to be completed.</p>
<p>Whilst commenting is good, it can be really easy to get carried away and turn our scripts into short stories with more comments than code! For more ‘final’ versions of code or code to share for QC, we should try to find that sweet spot between informative comments and not comment overload.</p>
<p>Here are some tips:</p>
<li>
concise and to the point
<li>
note any key dependencies
<li>
state what the code is doing
<li>
note why the code is doing something (helps for context)
<li>
sometimes useful to include hyperlink to website for context - try to keep this all in one place in your final code
</li>
<p>Below is an example of ‘final’ vs development comments in script.</p>
<details>
<p><summary> <em>Example: Commenting Final Script</em></summary></p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" title="1"><span class="co"># Filter data for LA in Wales only as all others fall outside study area</span></a>
<a class="sourceLine" id="cb16-2" title="2">data_wales &lt;-<span class="st"> </span>data_example <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb16-3" title="3"><span class="st">                </span><span class="kw">filter</span>(<span class="kw">str_detect</span>(Code, <span class="st">&quot;^W&quot;</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb16-4" title="4"><span class="st">                </span><span class="kw">rename</span>(<span class="st">&quot;total_pop&quot;</span> =<span class="st"> &quot;All ages&quot;</span>)</a>
<a class="sourceLine" id="cb16-5" title="5"></a>
<a class="sourceLine" id="cb16-6" title="6"><span class="co"># Join HB - these are required later in the analysis</span></a>
<a class="sourceLine" id="cb16-7" title="7">data_wales &lt;-<span class="st"> </span>data_wales <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb16-8" title="8"><span class="st">                </span><span class="kw">left_join</span>(hb_lkup,</a>
<a class="sourceLine" id="cb16-9" title="9">                          <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;Code&quot;</span> =<span class="st"> &quot;lacode&quot;</span>))</a>
<a class="sourceLine" id="cb16-10" title="10"></a>
<a class="sourceLine" id="cb16-11" title="11"><span class="co"># Plot total population</span></a>
<a class="sourceLine" id="cb16-12" title="12">chart_popwales &lt;-<span class="st"> </span><span class="kw">ggplot</span>(</a>
<a class="sourceLine" id="cb16-13" title="13">  data_wales,</a>
<a class="sourceLine" id="cb16-14" title="14">  <span class="kw">aes</span>(<span class="dt">x =</span> Name, <span class="dt">y =</span> total_pop)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb16-15" title="15"><span class="st">  </span><span class="kw">geom_col</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb16-16" title="16"><span class="st">    </span><span class="kw">scale_y_continuous</span>(</a>
<a class="sourceLine" id="cb16-17" title="17">    <span class="dt">name =</span> <span class="st">&quot;&quot;</span>, </a>
<a class="sourceLine" id="cb16-18" title="18">    <span class="dt">expand =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">0</span>), </a>
<a class="sourceLine" id="cb16-19" title="19">    <span class="dt">limits =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="kw">max</span>(data_wales<span class="op">$</span>total_pop) <span class="op">+</span><span class="st"> </span><span class="dv">100</span>) </a>
<a class="sourceLine" id="cb16-20" title="20">  ) <span class="op">+</span></a>
<a class="sourceLine" id="cb16-21" title="21"><span class="st">  </span><span class="kw">theme</span>(</a>
<a class="sourceLine" id="cb16-22" title="22">    <span class="dt">text =</span> <span class="kw">element_text</span>(<span class="dt">face =</span> <span class="st">&quot;plain&quot;</span>, <span class="dt">colour =</span> <span class="st">&quot;black&quot;</span>),</a>
<a class="sourceLine" id="cb16-23" title="23">    <span class="dt">panel.background =</span> <span class="kw">element_blank</span>(), </a>
<a class="sourceLine" id="cb16-24" title="24">    <span class="dt">axis.line.y =</span> <span class="kw">element_line</span>(<span class="dt">color =</span> <span class="st">&quot;#7F7F7F&quot;</span>), </a>
<a class="sourceLine" id="cb16-25" title="25">    <span class="dt">axis.ticks.y =</span> <span class="kw">element_blank</span>(),</a>
<a class="sourceLine" id="cb16-26" title="26">    <span class="dt">axis.line.x =</span> <span class="kw">element_line</span>(<span class="dt">color =</span> <span class="st">&quot;#7F7F7F&quot;</span>), </a>
<a class="sourceLine" id="cb16-27" title="27">    <span class="dt">axis.ticks.x =</span> <span class="kw">element_blank</span>(), </a>
<a class="sourceLine" id="cb16-28" title="28">    <span class="dt">axis.text.y =</span> <span class="kw">element_text</span>(<span class="dt">size =</span> <span class="dv">10</span>),</a>
<a class="sourceLine" id="cb16-29" title="29">    <span class="dt">axis.text.x =</span> <span class="kw">element_text</span>(</a>
<a class="sourceLine" id="cb16-30" title="30">      <span class="dt">size =</span> <span class="dv">10</span>,</a>
<a class="sourceLine" id="cb16-31" title="31">      <span class="dt">angle =</span> <span class="dv">90</span>, <span class="dt">vjust =</span> <span class="dv">1</span>, <span class="dt">hjust =</span> <span class="dv">1</span></a>
<a class="sourceLine" id="cb16-32" title="32">    )</a>
<a class="sourceLine" id="cb16-33" title="33">  ) </a>
<a class="sourceLine" id="cb16-34" title="34"></a>
<a class="sourceLine" id="cb16-35" title="35"><span class="co"># Print population chart</span></a>
<a class="sourceLine" id="cb16-36" title="36">chart_popwales            </a></code></pre></div>
</details>
<!-- Start of dropdown for example of development script -->
<details>
<p><summary> <em>Example: Commenting Development Script</em></summary></p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" title="1"><span class="co"># filter data for Wales LA only - this doesn&#39;t work</span></a>
<a class="sourceLine" id="cb17-2" title="2"><span class="co"># data_wales &lt;- data_example %&gt;%</span></a>
<a class="sourceLine" id="cb17-3" title="3"><span class="co">#                 filter(startsWith(Code, &quot;^W&quot;))</span></a>
<a class="sourceLine" id="cb17-4" title="4"></a>
<a class="sourceLine" id="cb17-5" title="5"><span class="co"># The above doesn&#39;t work, try alternative method using str_detect.</span></a>
<a class="sourceLine" id="cb17-6" title="6"><span class="co"># Useful website for reference: https://blog.exploratory.io/filter-with-text-data-952df792c2ba</span></a>
<a class="sourceLine" id="cb17-7" title="7">data_wales &lt;-<span class="st"> </span>data_example <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb17-8" title="8"><span class="st">                </span><span class="kw">filter</span>(<span class="kw">str_detect</span>(Code, <span class="st">&quot;^W&quot;</span>)) <span class="op">%&gt;%</span><span class="st">  </span><span class="co">## filter Code column for all LA starting with (^) the letter W</span></a>
<a class="sourceLine" id="cb17-9" title="9"><span class="st">                </span><span class="kw">rename</span>(<span class="st">&quot;total_pop&quot;</span> =<span class="st"> &quot;All ages&quot;</span>) <span class="co">#%&gt;% </span></a>
<a class="sourceLine" id="cb17-10" title="10">              <span class="co"># mutate(percentage_pop = total_pop/wales_total_pop*100)</span></a>
<a class="sourceLine" id="cb17-11" title="11"></a>
<a class="sourceLine" id="cb17-12" title="12"><span class="co"># Added health board - do we think this is needed?</span></a>
<a class="sourceLine" id="cb17-13" title="13">data_wales &lt;-<span class="st"> </span>data_wales <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb17-14" title="14"><span class="st">                </span><span class="kw">left_join</span>(hb_lkup, <span class="co">## join to lookup table</span></a>
<a class="sourceLine" id="cb17-15" title="15">                          <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;Code&quot;</span> =<span class="st"> &quot;lacode&quot;</span>)) <span class="co">## join on LA columns in the two datasets.</span></a>
<a class="sourceLine" id="cb17-16" title="16"></a>
<a class="sourceLine" id="cb17-17" title="17"><span class="co"># Attempt to plot as bar chart</span></a>
<a class="sourceLine" id="cb17-18" title="18">chart_popwales &lt;-<span class="st"> </span><span class="kw">ggplot</span>(</a>
<a class="sourceLine" id="cb17-19" title="19">  data_wales,</a>
<a class="sourceLine" id="cb17-20" title="20">  <span class="co"># aes(x = Name, y = percentage_pop),</span></a>
<a class="sourceLine" id="cb17-21" title="21">  <span class="kw">aes</span>(<span class="dt">x =</span> Name, <span class="dt">y =</span> total_pop)) <span class="op">+</span><span class="st"> </span><span class="co">## col name changed - plot total pop</span></a>
<a class="sourceLine" id="cb17-22" title="22"><span class="st">  </span><span class="kw">geom_col</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb17-23" title="23"></a>
<a class="sourceLine" id="cb17-24" title="24"><span class="st">  </span><span class="co"># geom_line(size = 0.5) +</span></a>
<a class="sourceLine" id="cb17-25" title="25"><span class="st">  </span></a>
<a class="sourceLine" id="cb17-26" title="26"><span class="co"># Add scale and set max to total pop + 100 buffer</span></a>
<a class="sourceLine" id="cb17-27" title="27"><span class="st">  </span><span class="kw">scale_y_continuous</span>(</a>
<a class="sourceLine" id="cb17-28" title="28">    <span class="dt">name =</span> <span class="st">&quot;&quot;</span>, <span class="co"># Removes y axis title</span></a>
<a class="sourceLine" id="cb17-29" title="29">    <span class="dt">expand =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">0</span>), <span class="co"># Removes gap before 0 at bottom of chart</span></a>
<a class="sourceLine" id="cb17-30" title="30">    <span class="dt">limits =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="kw">max</span>(data_wales<span class="op">$</span>total_pop) <span class="op">+</span><span class="st"> </span><span class="dv">100</span>) <span class="co"># Sets start and end of y axis based on max value of total population</span></a>
<a class="sourceLine" id="cb17-31" title="31">    <span class="co"># labels = comma ##adds comma to values</span></a>
<a class="sourceLine" id="cb17-32" title="32">  ) <span class="op">+</span></a>
<a class="sourceLine" id="cb17-33" title="33"><span class="st">  </span><span class="co">## Add theme - updated May 2021</span></a>
<a class="sourceLine" id="cb17-34" title="34"><span class="st">  </span><span class="kw">theme</span>(</a>
<a class="sourceLine" id="cb17-35" title="35">    <span class="dt">text =</span> <span class="kw">element_text</span>(<span class="dt">face =</span> <span class="st">&quot;plain&quot;</span>, <span class="dt">colour =</span> <span class="st">&quot;black&quot;</span>), <span class="co"># Use the theme function, change title style</span></a>
<a class="sourceLine" id="cb17-36" title="36">    <span class="dt">panel.background =</span> <span class="kw">element_blank</span>(), <span class="co"># Remove background</span></a>
<a class="sourceLine" id="cb17-37" title="37">    <span class="dt">axis.line.y =</span> <span class="kw">element_line</span>(<span class="dt">color =</span> <span class="st">&quot;#7F7F7F&quot;</span>), <span class="co"># Change y axis line to grey</span></a>
<a class="sourceLine" id="cb17-38" title="38">    <span class="dt">axis.ticks.y =</span> <span class="kw">element_blank</span>(), <span class="co"># Remove y axis tick marks</span></a>
<a class="sourceLine" id="cb17-39" title="39">    <span class="dt">axis.line.x =</span> <span class="kw">element_line</span>(<span class="dt">color =</span> <span class="st">&quot;#7F7F7F&quot;</span>), <span class="co"># Change x axis line to grey</span></a>
<a class="sourceLine" id="cb17-40" title="40">    <span class="dt">axis.ticks.x =</span> <span class="kw">element_blank</span>(), <span class="co"># Remove x axis tick marks</span></a>
<a class="sourceLine" id="cb17-41" title="41">    <span class="co"># axis.text.y = element_text(size=9),  #set axis text size</span></a>
<a class="sourceLine" id="cb17-42" title="42">    <span class="dt">axis.text.y =</span> <span class="kw">element_text</span>(<span class="dt">size =</span> <span class="dv">10</span>),</a>
<a class="sourceLine" id="cb17-43" title="43">    <span class="dt">axis.text.x =</span> <span class="kw">element_text</span>(</a>
<a class="sourceLine" id="cb17-44" title="44">      <span class="dt">size =</span> <span class="dv">10</span>,</a>
<a class="sourceLine" id="cb17-45" title="45">      <span class="dt">angle =</span> <span class="dv">90</span>, <span class="dt">vjust =</span> <span class="dv">1</span>, <span class="dt">hjust =</span> <span class="dv">1</span> <span class="co"># set axis text size and position from x axis. changed from 45</span></a>
<a class="sourceLine" id="cb17-46" title="46">    )</a>
<a class="sourceLine" id="cb17-47" title="47">  ) </a>
<a class="sourceLine" id="cb17-48" title="48"></a>
<a class="sourceLine" id="cb17-49" title="49"><span class="co"># Print population chart</span></a>
<a class="sourceLine" id="cb17-50" title="50">chart_popwales            </a></code></pre></div>
</details>
</div>
</div>
<div id="styling-internal-structure" class="section level2">
<h2><span class="header-section-number">4.2</span> Internal Structure</h2>
<p>Any easy way of improving readability is to include lines of <code> #—- </code>, <code> #&gt;&gt;&gt;&gt; </code>, <code> #### </code> and <code> #==== </code> to break up chunks of code. These might be used as inline or as as chunk (see examples below).</p>
<p>Note that lines ending in 4+ hashes (<code> #### </code>), dashes (<code> #—- </code>) or equals (<code> #==== </code>) denotes a section which can be used for navigating through longer scripts. In the figure below, examples 1-6 would denotes a section. See also <a href="#names-r-code-chunks">Naming R Code Chunks</a> section in this guide.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" title="1"><span class="co">#===== Example 1 ======</span></a>
<a class="sourceLine" id="cb18-2" title="2"></a>
<a class="sourceLine" id="cb18-3" title="3"><span class="co">#----- Example 2 ------</span></a>
<a class="sourceLine" id="cb18-4" title="4"></a>
<a class="sourceLine" id="cb18-5" title="5"><span class="co">#### Example 3 #######</span></a>
<a class="sourceLine" id="cb18-6" title="6"></a>
<a class="sourceLine" id="cb18-7" title="7"></a>
<a class="sourceLine" id="cb18-8" title="8"></a>
<a class="sourceLine" id="cb18-9" title="9"><span class="co"># Example 4 ---------------------------------</span></a>
<a class="sourceLine" id="cb18-10" title="10"> </a>
<a class="sourceLine" id="cb18-11" title="11"><span class="co"># Example 5 =================================</span></a>
<a class="sourceLine" id="cb18-12" title="12"> </a>
<a class="sourceLine" id="cb18-13" title="13"><span class="co"># Example 6 ###############################</span></a>
<a class="sourceLine" id="cb18-14" title="14"></a>
<a class="sourceLine" id="cb18-15" title="15"></a>
<a class="sourceLine" id="cb18-16" title="16"></a>
<a class="sourceLine" id="cb18-17" title="17"><span class="co">#===============</span></a>
<a class="sourceLine" id="cb18-18" title="18"><span class="co"># Example 7</span></a>
<a class="sourceLine" id="cb18-19" title="19"><span class="co">#===============</span></a>
<a class="sourceLine" id="cb18-20" title="20"></a>
<a class="sourceLine" id="cb18-21" title="21"><span class="co">#---------------</span></a>
<a class="sourceLine" id="cb18-22" title="22"><span class="co"># Example 8</span></a>
<a class="sourceLine" id="cb18-23" title="23"><span class="co">#---------------</span></a>
<a class="sourceLine" id="cb18-24" title="24"></a>
<a class="sourceLine" id="cb18-25" title="25"><span class="co">#&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span></a>
<a class="sourceLine" id="cb18-26" title="26"><span class="co"># Example 9</span></a>
<a class="sourceLine" id="cb18-27" title="27"><span class="co">#&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span></a></code></pre></div>
</div>
<div id="styling-assignment" class="section level2">
<h2><span class="header-section-number">4.3</span> Assignment</h2>
<p>When assigning to an object, always use <code> &lt;- </code> rather than <code> = </code>.</p>
<p>Often the object is on the left, with assigned variable/code on the right (see example below).</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" title="1"><span class="co">## Assignment: Good</span></a>
<a class="sourceLine" id="cb19-2" title="2"><span class="co"># Example 1</span></a>
<a class="sourceLine" id="cb19-3" title="3">x &lt;-<span class="st"> </span><span class="dv">10</span></a>
<a class="sourceLine" id="cb19-4" title="4"></a>
<a class="sourceLine" id="cb19-5" title="5"><span class="co"># Example 2</span></a>
<a class="sourceLine" id="cb19-6" title="6">example &lt;-<span class="st"> </span>data <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb19-7" title="7"><span class="st">  </span><span class="kw">filter</span>(x <span class="op">==</span><span class="st"> </span><span class="dv">2</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb19-8" title="8"><span class="st">  </span><span class="kw">group_by</span>(local_authority)</a>
<a class="sourceLine" id="cb19-9" title="9"></a>
<a class="sourceLine" id="cb19-10" title="10"><span class="co"># Example 3</span></a>
<a class="sourceLine" id="cb19-11" title="11">example &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb19-12" title="12"><span class="st">  </span>data <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb19-13" title="13"><span class="st">  </span><span class="kw">filter</span>(x <span class="op">==</span><span class="st"> </span><span class="dv">2</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb19-14" title="14"><span class="st">  </span><span class="kw">group_by</span>(local_authority)</a>
<a class="sourceLine" id="cb19-15" title="15"></a>
<a class="sourceLine" id="cb19-16" title="16"></a>
<a class="sourceLine" id="cb19-17" title="17"><span class="co">## Assignment: Avoid (used of =, long lines of code, assignment on right)</span></a>
<a class="sourceLine" id="cb19-18" title="18"><span class="co"># Example 1</span></a>
<a class="sourceLine" id="cb19-19" title="19">x =<span class="st"> </span><span class="dv">10</span></a>
<a class="sourceLine" id="cb19-20" title="20"></a>
<a class="sourceLine" id="cb19-21" title="21"><span class="co"># Example 2</span></a>
<a class="sourceLine" id="cb19-22" title="22">example &lt;-<span class="st">  </span>data <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(x <span class="op">==</span><span class="st"> </span><span class="dv">2</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(local_authority)</a>
<a class="sourceLine" id="cb19-23" title="23"></a>
<a class="sourceLine" id="cb19-24" title="24"><span class="co"># Example 3</span></a>
<a class="sourceLine" id="cb19-25" title="25">  data <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb19-26" title="26"><span class="st">  </span><span class="kw">filter</span>(x <span class="op">==</span><span class="st"> </span><span class="dv">2</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb19-27" title="27"><span class="st">  </span><span class="kw">group_by</span>(local_authority) -&gt;<span class="st"> </span>example</a></code></pre></div>
</div>
<div id="styling-whitespace" class="section level2">
<h2><span class="header-section-number">4.4</span> Whitespace</h2>
<p>Similar to punctuation, adding spaces to code isn’t essential but it will make it easier to understand.</p>
Using spacing before and/or after the following helps improve the readability of code:
<li>
comma: always but a space after the comma <br>
<li>
operators: include space before and after (==, +, -, &lt;-)
<li>
parenthesis/function: followed by space
</li>
<div id="styling-commas" class="section level4">
<h4><span class="header-section-number">4.4.0.1</span> Commas</h4>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb20-1" title="1"><span class="co"># Comma: Good</span></a>
<a class="sourceLine" id="cb20-2" title="2">x[, <span class="dv">1</span>]</a>
<a class="sourceLine" id="cb20-3" title="3"></a>
<a class="sourceLine" id="cb20-4" title="4"><span class="co"># Comma: Avoid (lack of space)</span></a>
<a class="sourceLine" id="cb20-5" title="5">x[,<span class="dv">1</span>]</a>
<a class="sourceLine" id="cb20-6" title="6">x[ ,<span class="dv">1</span>]</a>
<a class="sourceLine" id="cb20-7" title="7">x[ , <span class="dv">1</span>]</a></code></pre></div>
</div>
<div id="styling-operators" class="section level3">
<h3><span class="header-section-number">4.4.1</span> Operators</h3>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb21-1" title="1"><span class="co"># Operators: Good</span></a>
<a class="sourceLine" id="cb21-2" title="2">example_<span class="dv">1</span> &lt;-<span class="st"> </span>(x <span class="op">+</span><span class="st"> </span>y) <span class="op">-</span><span class="st"> </span><span class="dv">10</span></a>
<a class="sourceLine" id="cb21-3" title="3">example_<span class="dv">3</span> &lt;-<span class="st"> </span><span class="kw">filter</span>(data, local_authority <span class="op">==</span><span class="st"> &quot;Cardiff&quot;</span>)</a>
<a class="sourceLine" id="cb21-4" title="4"></a>
<a class="sourceLine" id="cb21-5" title="5"><span class="co"># Operators: Avoid</span></a>
<a class="sourceLine" id="cb21-6" title="6">example_<span class="dv">1</span>&lt;-x<span class="op">+</span>y<span class="dv">-10</span></a>
<a class="sourceLine" id="cb21-7" title="7">example_<span class="dv">3</span>&lt;-<span class="kw">filter</span>(data,local_authority<span class="op">==</span><span class="st">&quot;Cardiff&quot;</span>)</a></code></pre></div>
</div>
<div id="styling-functions" class="section level3">
<h3><span class="header-section-number">4.4.2</span> Parenthesis &amp; Functions</h3>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb22-1" title="1"><span class="co"># Parenthesis &amp; functions: Good</span></a>
<a class="sourceLine" id="cb22-2" title="2">example &lt;-<span class="st"> </span><span class="kw">mean</span>(x, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb22-3" title="3"></a>
<a class="sourceLine" id="cb22-4" title="4">fn_example &lt;-<span class="st"> </span><span class="cf">function</span>(x, y, z){</a>
<a class="sourceLine" id="cb22-5" title="5">  <span class="co"># do something with x, y, z here ...</span></a>
<a class="sourceLine" id="cb22-6" title="6">}</a>
<a class="sourceLine" id="cb22-7" title="7"></a>
<a class="sourceLine" id="cb22-8" title="8"><span class="co"># Parenthesis &amp; functions: Avoid</span></a>
<a class="sourceLine" id="cb22-9" title="9">example&lt;-<span class="kw">mean</span>(x,<span class="dt">na.rm=</span><span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb22-10" title="10"></a>
<a class="sourceLine" id="cb22-11" title="11">fn_example&lt;-<span class="cf">function</span>(x,y,z){<span class="co"># do something with x, y, z here ...}</span></a></code></pre></div>
</div>
</div>
<div id="styling-long-lines" class="section level2">
<h2><span class="header-section-number">4.5</span> Avoid Long lines</h2>
<p>When using packages such as ggplot or dplyr, the pipe function (<code> %&gt;% </code>) and <code> + </code> should have a space before it, with any subsequent commands on a new a new line and a two space indentation.</p>
<p>Tip: It’s sometimes useful to add space between lines of code to break it up</p>
<div id="styling-pipe" class="section level3">
<h3><span class="header-section-number">4.5.1</span> Pipe</h3>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb23-1" title="1"><span class="co"># Whitespace: Good</span></a>
<a class="sourceLine" id="cb23-2" title="2"></a>
<a class="sourceLine" id="cb23-3" title="3">example &lt;-<span class="st"> </span>data_ONS_MYE <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb23-4" title="4"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Year =</span> <span class="st">&quot;2019&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb23-5" title="5"><span class="st">  </span><span class="kw">select</span>(</a>
<a class="sourceLine" id="cb23-6" title="6">    <span class="st">&quot;local_authority&quot;</span>,</a>
<a class="sourceLine" id="cb23-7" title="7">    <span class="st">&quot;health_board&quot;</span>,</a>
<a class="sourceLine" id="cb23-8" title="8">    <span class="st">&quot;total_population&quot;</span></a>
<a class="sourceLine" id="cb23-9" title="9">  )</a>
<a class="sourceLine" id="cb23-10" title="10"></a>
<a class="sourceLine" id="cb23-11" title="11"><span class="co"># Whitespace: Avoid</span></a>
<a class="sourceLine" id="cb23-12" title="12"></a>
<a class="sourceLine" id="cb23-13" title="13">example &lt;-<span class="st"> </span>data_ONS_MYE <span class="op">%&gt;%</span><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Year =</span> <span class="st">&quot;2019&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="st">&quot;local_authority&quot;</span>, <span class="st">&quot;health_board&quot;</span>, <span class="st">&quot;total_population&quot;</span>)</a></code></pre></div>
<p>Whilst most code using pipe (<code> %&gt;% </code>) will be on a new indented line, one-step pipes are often on a single line.
However, if you start expanding the code then this should be changed to multiple lines.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb24-1" title="1">data <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">arrange</span>(population)</a>
<a class="sourceLine" id="cb24-2" title="2"></a>
<a class="sourceLine" id="cb24-3" title="3">data <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb24-4" title="4"><span class="st">  </span><span class="kw">arrange</span>(population)</a></code></pre></div>
<p><strong>Top tip</strong>: it is suggested that 80 characters is the maximum for a line of code.
You can add a vertical ruler to your code to help you keep within these guidelines by:
<br>
<em>Tools</em> -&gt; <em>Global options</em> -&gt; <em>Code</em> -&gt; <em>Display</em> -&gt; check <em>Show margins</em> -&gt; <em>Ok</em>
</br></p>
</div>
<div id="styling-charts" class="section level3">
<h3><span class="header-section-number">4.5.2</span> Charts</h3>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb25-1" title="1"><span class="co"># Whitespace Chart: Good</span></a>
<a class="sourceLine" id="cb25-2" title="2"></a>
<a class="sourceLine" id="cb25-3" title="3">chart_example &lt;-<span class="st"> </span>data_ONS_MYE <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb25-4" title="4"><span class="st">  </span><span class="kw">filter</span>(local_authority <span class="op">==</span><span class="st"> &quot;Cardiff&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb25-5" title="5"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> year, <span class="dt">y =</span> total_population)) <span class="op">+</span></a>
<a class="sourceLine" id="cb25-6" title="6"><span class="st">  </span><span class="kw">geom_line</span>(<span class="dt">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb25-7" title="7"><span class="st">  </span><span class="kw">theme</span>(</a>
<a class="sourceLine" id="cb25-8" title="8">    <span class="dt">panel.background =</span> <span class="kw">element_blank</span>(),</a>
<a class="sourceLine" id="cb25-9" title="9">    <span class="dt">legend.position =</span> <span class="st">&quot;top&quot;</span>,</a>
<a class="sourceLine" id="cb25-10" title="10">    <span class="dt">legend.title =</span> <span class="kw">element_blank</span>()</a>
<a class="sourceLine" id="cb25-11" title="11">  )</a>
<a class="sourceLine" id="cb25-12" title="12"></a>
<a class="sourceLine" id="cb25-13" title="13"><span class="co"># Whitespace Chart: Avoid</span></a>
<a class="sourceLine" id="cb25-14" title="14"></a>
<a class="sourceLine" id="cb25-15" title="15">chart_example &lt;-<span class="st"> </span>data_ONS_MYE <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb25-16" title="16"><span class="st">  </span><span class="kw">filter</span>(local_authority <span class="op">==</span><span class="st"> &quot;Cardiff&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb25-17" title="17"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> year, <span class="dt">y =</span> total_population)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>(<span class="dt">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="op">+</span><span class="st">  </span></a>
<a class="sourceLine" id="cb25-18" title="18"><span class="st">  </span><span class="kw">theme</span>( <span class="dt">panel.background =</span> <span class="kw">element_blank</span>(),<span class="dt">legend.position =</span> <span class="st">&quot;top&quot;</span>,<span class="dt">legend.title =</span> <span class="kw">element_blank</span>())</a></code></pre></div>
</div>
</div>
<div id="styling-arguments" class="section level2">
<h2><span class="header-section-number">4.6</span> Arguments</h2>
<p>There are some commands which can be executed without an argument.</p>
<p>In these instances you should still include <code> () </code>, rather than omitting it completely (see example below).</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb26-1" title="1"><span class="co"># Arguments: Good</span></a>
<a class="sourceLine" id="cb26-2" title="2"> data <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb26-3" title="3"><span class="st">  </span><span class="kw">distinct</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb26-4" title="4"><span class="st">  </span><span class="kw">sort</span>()</a>
<a class="sourceLine" id="cb26-5" title="5"></a>
<a class="sourceLine" id="cb26-6" title="6"><span class="co"># Arguments: Avoid</span></a>
<a class="sourceLine" id="cb26-7" title="7">data <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb26-8" title="8"><span class="st">  </span>distinct <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb26-9" title="9"><span class="st">  </span>sort</a></code></pre></div>
<hr>
</div>
</div>
<div id="packages" class="section level1">
<h1><span class="header-section-number">5</span> Packages</h1>
<p>There are two key packages which can help style your code (both of which are in line with tidyverse style guide):</p>
<li>
<a href="https://styler.r-lib.org/">styler</a> : allows you to highlight code and apply formatting
<li>
<a href="https://github.com/jimhester/lintr">lintr</a> : provides a series of suggested changes for your code in the console
</li>
<div id="packages-getting-started" class="section level2">
<h2><span class="header-section-number">5.1</span> Getting started</h2>
<p>First you will need to ensure you have the <strong>styler</strong> and <strong>lintr</strong> packages installed.
This can be done in the following way:</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb27-1" title="1"><span class="kw">install.packages</span>(<span class="st">&quot;styler&quot;</span>)</a>
<a class="sourceLine" id="cb27-2" title="2"><span class="kw">install.packages</span>(<span class="st">&quot;lintr&quot;</span>)</a></code></pre></div>
</div>
<div id="packages-load" class="section level2">
<h2><span class="header-section-number">5.2</span> Load packages</h2>
<p>Load the packages required for the analysis.
In this example, we are also using tidyverse for data manipulation.</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb28-1" title="1"><span class="kw">library</span>(tidyverse)</a>
<a class="sourceLine" id="cb28-2" title="2"><span class="kw">library</span>(styler)</a>
<a class="sourceLine" id="cb28-3" title="3"><span class="kw">library</span>(lintr)</a></code></pre></div>
</div>
<div id="packages-import-data" class="section level2">
<h2><span class="header-section-number">5.3</span> Import data</h2>
<p>Read in any data required for your analysis.
This example uses data built into R.</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb29-1" title="1">data_trees &lt;-<span class="st"> </span>trees </a></code></pre></div>
</div>
<div id="packages-style-selection" class="section level2">
<h2><span class="header-section-number">5.4</span> Style selection examples</h2>
<p><strong>Example 1</strong></p>
<p>This example highlights the code and applies <code> ‘Addins’ -&gt; ‘Style selection’ </code>.</p>
<p><img src="styler_selection_v0a.jpg" width="200" /></p>
<p>Note that when using **styler* for the first time, you might be required to agree a suggested location for cache. This will appear in your console and will require you to confirm before it can run the code. You should only need to do this once.</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb30-1" title="1">example_<span class="dv">1</span> &lt;-<span class="st"> </span>data_trees <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">count</span>(Height) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">Variable =</span> <span class="st">&quot;Trees&quot;</span>)</a>
<a class="sourceLine" id="cb30-2" title="2"></a>
<a class="sourceLine" id="cb30-3" title="3"><span class="co">#--------------------------------------------------------------  </span></a>
<a class="sourceLine" id="cb30-4" title="4"><span class="co">## Highlight code and select &#39;Addins&#39; -&gt; &#39;Style selection&#39;.</span></a>
<a class="sourceLine" id="cb30-5" title="5"><span class="co">## This reformats the code to the following format, in line with tidyverse guidelines</span></a>
<a class="sourceLine" id="cb30-6" title="6"><span class="co">#-------------------------------------------------------------- </span></a>
<a class="sourceLine" id="cb30-7" title="7">example_<span class="dv">1</span> &lt;-<span class="st"> </span>data_trees <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb30-8" title="8"><span class="st">  </span><span class="kw">count</span>(Height) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb30-9" title="9"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Variable =</span> <span class="st">&quot;Trees&quot;</span>)</a></code></pre></div>
<p><strong>Example 2</strong></p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb31-1" title="1"><span class="co">## Example unformatted code</span></a>
<a class="sourceLine" id="cb31-2" title="2">example_<span class="dv">2</span> &lt;-<span class="st"> </span><span class="cf">function</span>(a,b){temp&lt;-a<span class="op">+</span>b}</a>
<a class="sourceLine" id="cb31-3" title="3"></a>
<a class="sourceLine" id="cb31-4" title="4"><span class="co">#--------------------------------------------------------------  </span></a>
<a class="sourceLine" id="cb31-5" title="5"><span class="co">## Highlight code and select &#39;Addins&#39; -&gt; &#39;Style selection&#39;.</span></a>
<a class="sourceLine" id="cb31-6" title="6"><span class="co">## This reformats the code to the following format, in line with tidyverse guidelines</span></a>
<a class="sourceLine" id="cb31-7" title="7"><span class="co">#-------------------------------------------------------------- </span></a>
<a class="sourceLine" id="cb31-8" title="8"></a>
<a class="sourceLine" id="cb31-9" title="9"><span class="co">## Apply styler</span></a>
<a class="sourceLine" id="cb31-10" title="10">example_<span class="dv">2</span> &lt;-<span class="st"> </span><span class="cf">function</span>(a, b) {</a>
<a class="sourceLine" id="cb31-11" title="11">  temp &lt;-<span class="st"> </span>a <span class="op">+</span><span class="st"> </span>b</a>
<a class="sourceLine" id="cb31-12" title="12">}</a></code></pre></div>
</div>
<div id="packages-lintr" class="section level2">
<h2><span class="header-section-number">5.5</span> Lintr Example</h2>
<p>If you select <code> ‘Addins’ -&gt; ‘LINTR’ </code> you will have the option to use it on either the entire file or just a package.</p>
<p>Selecting the entire file provide guidance in your console below on how to format code.</p>
<p><img src="lintr_v0a.jpg" width="1000" /></p>
<p>Note that when you run <strong>lintr</strong> for the first time, you may be required to update your <strong>miniUI</strong> package. If this is the case, a message will appear in the console.</p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>


    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
},
"search": false
});
});
</script>

</body>

</html>
